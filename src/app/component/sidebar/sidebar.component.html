<div
  class="fixed inset-y-0 left-0 z-30 bg-white shadow-xl transform transition-transform duration-300 ease-in-out border-r border-gray-200 mt-16"
  [ngClass]="{
    'translate-x-0 w-64': sidebarOpen, 
    '-translate-x-full w-64': !sidebarOpen && !isDesktop, 
    'w-20': !sidebarOpen && isDesktop,
    'md:translate-x-0': isDesktop
  }">

  <!-- User Quick Profile with Role Badge -->
  <div class="px-4 py-3 border-b border-gray-200 bg-gray-50" [ngClass]="{'px-2': !sidebarOpen && isDesktop}">
    <div class="flex items-center"
      [ngClass]="{'space-x-3': sidebarOpen || !isDesktop, 'justify-center': !sidebarOpen && isDesktop}">
      <div
        class="h-10 w-10 rounded-full bg-gradient-to-br from-indigo-500 to-purple-600 flex items-center justify-center text-white font-medium uppercase shadow-sm ring-2 ring-white">
        {{ userInitials }}
      </div>
      <div class="flex-1 min-w-0" *ngIf="sidebarOpen || !isDesktop">
        <p class="text-sm font-medium text-gray-900 truncate">{{ username }}</p>
        <div class="flex items-center mt-0.5">
          <!-- Role badge -->
          <span class="inline-flex items-center px-1.5 py-0.5 rounded-full text-xs font-medium shadow-sm" [ngClass]="{
              'bg-purple-100 text-purple-800': role === 'admin',
              'bg-blue-100 text-blue-800': role === 'hod',
              'bg-green-100 text-green-800': role === 'employee',
              'bg-yellow-100 text-yellow-800': role === 'client'
            }">
            <i class="mr-0.5 fa-sm" [ngClass]="{
                'fas fa-user-shield': role === 'admin',
                'fas fa-user-tie': role === 'hod',
                'fas fa-user': role === 'employee',
                'fas fa-user-alt': role === 'client'
              }"></i>
            {{ formatRoleDisplay(role) }}
          </span>
        </div>
      </div>
      <!-- Status indicator -->
      <div class="flex items-center" *ngIf="sidebarOpen || !isDesktop">
        <span class="w-2.5 h-2.5 rounded-full bg-green-500 mr-1.5 animate-pulse-subtle"></span>
        <span class="text-xs font-medium text-gray-600">Online</span>
      </div>
    </div>
  </div>

  <!-- Sidebar Navigation with Enhanced Scrolling -->
  <div class="overflow-y-auto custom-scrollbar"
    [ngClass]="{'p-4': sidebarOpen || !isDesktop, 'p-2': !sidebarOpen && isDesktop}"
    style="max-height: calc(100vh - 150px)">

    <!-- Dashboard Link -->
    <a [routerLink]="['/', role, 'dashboard']" routerLinkActive="bg-blue-50 text-blue-700"
      [routerLinkActiveOptions]="{exact: true}"
      class="flex items-center py-2.5 rounded-lg hover:bg-gray-100 transition-all duration-200 group nav-link"
      [ngClass]="{'px-3': sidebarOpen || !isDesktop, 'px-2 justify-center': !sidebarOpen && isDesktop, 'border-l-4 border-blue-600': sidebarOpen && isActiveRoute(['/', role, 'dashboard'])}">
      <div
        class="w-6 h-6 flex items-center justify-center rounded-lg text-gray-500 group-hover:text-blue-600 group-hover:bg-blue-100/50 transition-colors"
        [ngClass]="{'mr-3': sidebarOpen || !isDesktop}">
        <i class="fas fa-tachometer-alt"></i>
      </div>
      <span *ngIf="sidebarOpen || !isDesktop">Dashboard</span>
    </a>

    <!-- Complaints Management Section -->
    <div [ngClass]="{'pt-4': sidebarOpen || !isDesktop, 'pt-3': !sidebarOpen && isDesktop}">
      <p *ngIf="sidebarOpen || !isDesktop"
        class="px-3 text-xs font-semibold text-gray-500 uppercase tracking-wider section-title">COMPLAINTS</p>
      <p *ngIf="!sidebarOpen && isDesktop"
        class="flex justify-center text-xs font-semibold text-gray-500 tracking-wider section-title">
        <i class="fas fa-exclamation-circle"></i>
      </p>

      <a [routerLink]="['/', role, 'complaints']" routerLinkActive="bg-blue-50 text-blue-700"
        [routerLinkActiveOptions]="{exact: true}"
        class="flex items-center py-2.5 mt-1 rounded-lg hover:bg-gray-100 transition-all duration-200 group nav-link"
        [ngClass]="{'px-3': sidebarOpen || !isDesktop, 'px-2 justify-center': !sidebarOpen && isDesktop, 'border-l-4 border-blue-600': sidebarOpen && isActiveRoute(['/', role, 'complaints'])}">
        <div
          class="w-6 h-6 flex items-center justify-center rounded-lg text-gray-500 group-hover:text-blue-600 group-hover:bg-blue-100/50 transition-colors"
          [ngClass]="{'mr-3': sidebarOpen || !isDesktop}">
          <i class="fas fa-clipboard-list"></i>
        </div>
        <span *ngIf="sidebarOpen || !isDesktop">All Complaints</span>
      </a>

      <a [routerLink]="['/', role, 'assigned-complaints']" routerLinkActive="bg-blue-50 text-blue-700"
        [routerLinkActiveOptions]="{exact: true}"
        class="flex items-center py-2.5 rounded-lg hover:bg-gray-100 transition-all duration-200 group nav-link relative"
        [ngClass]="{'px-3': sidebarOpen || !isDesktop, 'px-2 justify-center': !sidebarOpen && isDesktop, 'border-l-4 border-blue-600': sidebarOpen && isActiveRoute(['/', role, 'assigned-complaints'])}">
        <div
          class="w-6 h-6 flex items-center justify-center rounded-lg text-gray-500 group-hover:text-blue-600 group-hover:bg-blue-100/50 transition-colors"
          [ngClass]="{'mr-3': sidebarOpen || !isDesktop}">
          <i class="fas fa-tasks"></i>
        </div>
        <span *ngIf="sidebarOpen || !isDesktop">Assigned to Me</span>
        <span *ngIf="(sidebarOpen || !isDesktop) && assignedCount > 0"
          class="ml-auto bg-blue-100 text-blue-800 text-xs font-medium px-2 py-0.5 rounded-full count-badge">
          {{ assignedCount }}
        </span>
        <span *ngIf="!sidebarOpen && isDesktop && assignedCount > 0"
          class="absolute -top-1 -right-1 bg-blue-500 text-white text-xs rounded-full h-4 w-4 flex items-center justify-center">
          {{ assignedCount }}
        </span>
      </a>

      <a [routerLink]="['/', role, 'created-complaints']" routerLinkActive="bg-blue-50 text-blue-700"
        [routerLinkActiveOptions]="{exact: true}"
        class="flex items-center py-2.5 rounded-lg hover:bg-gray-100 transition-all duration-200 group nav-link"
        [ngClass]="{'px-3': sidebarOpen || !isDesktop, 'px-2 justify-center': !sidebarOpen && isDesktop, 'border-l-4 border-blue-600': sidebarOpen && isActiveRoute(['/', role, 'created-complaints'])}">
        <div
          class="w-6 h-6 flex items-center justify-center rounded-lg text-gray-500 group-hover:text-blue-600 group-hover:bg-blue-100/50 transition-colors"
          [ngClass]="{'mr-3': sidebarOpen || !isDesktop}">
          <i class="fas fa-pen-alt"></i>
        </div>
        <span *ngIf="sidebarOpen || !isDesktop">Created by Me</span>
      </a>

      <a [routerLink]="['/', role, 'urgent-complaints']" routerLinkActive="bg-blue-50 text-blue-700"
        [routerLinkActiveOptions]="{exact: true}"
        class="flex items-center py-2.5 rounded-lg hover:bg-gray-100 transition-all duration-200 group nav-link relative"
        [ngClass]="{'px-3': sidebarOpen || !isDesktop, 'px-2 justify-center': !sidebarOpen && isDesktop, 'border-l-4 border-blue-600': sidebarOpen && isActiveRoute(['/', role, 'urgent-complaints'])}">
        <div
          class="w-6 h-6 flex items-center justify-center rounded-lg text-gray-500 group-hover:text-blue-600 group-hover:bg-blue-100/50 transition-colors"
          [ngClass]="{'mr-3': sidebarOpen || !isDesktop}">
          <i class="fas fa-exclamation-circle"></i>
        </div>
        <span *ngIf="sidebarOpen || !isDesktop">Urgent</span>
        <span *ngIf="(sidebarOpen || !isDesktop) && urgentCount > 0"
          class="ml-auto bg-red-100 text-red-800 text-xs font-medium px-2 py-0.5 rounded-full count-badge urgent-badge">
          {{ urgentCount }}
        </span>
        <span *ngIf="!sidebarOpen && isDesktop && urgentCount > 0"
          class="absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full h-4 w-4 flex items-center justify-center animate-pulse-subtle">
          {{ urgentCount }}
        </span>
      </a>
    </div>

    <!-- Suggestions Section -->
    <div [ngClass]="{'pt-4': sidebarOpen || !isDesktop, 'pt-3': !sidebarOpen && isDesktop}">
      <p *ngIf="sidebarOpen || !isDesktop"
        class="px-3 text-xs font-semibold text-gray-500 uppercase tracking-wider section-title">SUGGESTIONS</p>
      <p *ngIf="!sidebarOpen && isDesktop"
        class="flex justify-center text-xs font-semibold text-gray-500 tracking-wider section-title">
        <i class="fas fa-lightbulb"></i>
      </p>

      <a [routerLink]="['/', role, 'suggestions']" routerLinkActive="bg-blue-50 text-blue-700"
        [routerLinkActiveOptions]="{exact: true}"
        class="flex items-center py-2.5 mt-1 rounded-lg hover:bg-gray-100 transition-all duration-200 group nav-link"
        [ngClass]="{'px-3': sidebarOpen || !isDesktop, 'px-2 justify-center': !sidebarOpen && isDesktop, 'border-l-4 border-blue-600': sidebarOpen && isActiveRoute(['/', role, 'suggestions'])}">
        <div
          class="w-6 h-6 flex items-center justify-center rounded-lg text-gray-500 group-hover:text-blue-600 group-hover:bg-blue-100/50 transition-colors"
          [ngClass]="{'mr-3': sidebarOpen || !isDesktop}">
          <i class="fas fa-lightbulb"></i>
        </div>
        <span *ngIf="sidebarOpen || !isDesktop">All Suggestions</span>
      </a>

      <a [routerLink]="['/', role, 'top-suggestions']" routerLinkActive="bg-blue-50 text-blue-700"
        [routerLinkActiveOptions]="{exact: true}"
        class="flex items-center py-2.5 rounded-lg hover:bg-gray-100 transition-all duration-200 group nav-link"
        [ngClass]="{'px-3': sidebarOpen || !isDesktop, 'px-2 justify-center': !sidebarOpen && isDesktop, 'border-l-4 border-blue-600': sidebarOpen && isActiveRoute(['/', role, 'top-suggestions'])}">
        <div
          class="w-6 h-6 flex items-center justify-center rounded-lg text-gray-500 group-hover:text-blue-600 group-hover:bg-blue-100/50 transition-colors"
          [ngClass]="{'mr-3': sidebarOpen || !isDesktop}">
          <i class="fas fa-star"></i>
        </div>
        <span *ngIf="sidebarOpen || !isDesktop">Top Rated</span>
      </a>
    </div>

    <!-- Analytics Section -->
    <div [ngClass]="{'pt-4': sidebarOpen || !isDesktop, 'pt-3': !sidebarOpen && isDesktop}">
      <p *ngIf="sidebarOpen || !isDesktop"
        class="px-3 text-xs font-semibold text-gray-500 uppercase tracking-wider section-title">ANALYTICS</p>
      <p *ngIf="!sidebarOpen && isDesktop"
        class="flex justify-center text-xs font-semibold text-gray-500 tracking-wider section-title">
        <i class="fas fa-chart-bar"></i>
      </p>

      <a [routerLink]="['/', role, 'performance']" routerLinkActive="bg-blue-50 text-blue-700"
        [routerLinkActiveOptions]="{exact: true}"
        class="flex items-center py-2.5 mt-1 rounded-lg hover:bg-gray-100 transition-all duration-200 group nav-link"
        [ngClass]="{'px-3': sidebarOpen || !isDesktop, 'px-2 justify-center': !sidebarOpen && isDesktop, 'border-l-4 border-blue-600': sidebarOpen && isActiveRoute(['/', role, 'performance'])}">
        <div
          class="w-6 h-6 flex items-center justify-center rounded-lg text-gray-500 group-hover:text-blue-600 group-hover:bg-blue-100/50 transition-colors"
          [ngClass]="{'mr-3': sidebarOpen || !isDesktop}">
          <i class="fas fa-chart-line"></i>
        </div>
        <span *ngIf="sidebarOpen || !isDesktop">Performance</span>
      </a>

      <a [routerLink]="['/', role, 'trends']" routerLinkActive="bg-blue-50 text-blue-700"
        [routerLinkActiveOptions]="{exact: true}"
        class="flex items-center py-2.5 rounded-lg hover:bg-gray-100 transition-all duration-200 group nav-link"
        [ngClass]="{'px-3': sidebarOpen || !isDesktop, 'px-2 justify-center': !sidebarOpen && isDesktop, 'border-l-4 border-blue-600': sidebarOpen && isActiveRoute(['/', role, 'trends'])}">
        <div
          class="w-6 h-6 flex items-center justify-center rounded-lg text-gray-500 group-hover:text-blue-600 group-hover:bg-blue-100/50 transition-colors"
          [ngClass]="{'mr-3': sidebarOpen || !isDesktop}">
          <i class="fas fa-chart-pie"></i>
        </div>
        <span *ngIf="sidebarOpen || !isDesktop">Trends</span>
      </a>

      <a [routerLink]="['/', role, 'reports']" routerLinkActive="bg-blue-50 text-blue-700"
        [routerLinkActiveOptions]="{exact: true}"
        class="flex items-center py-2.5 rounded-lg hover:bg-gray-100 transition-all duration-200 group nav-link"
        [ngClass]="{'px-3': sidebarOpen || !isDesktop, 'px-2 justify-center': !sidebarOpen && isDesktop, 'border-l-4 border-blue-600': sidebarOpen && isActiveRoute(['/', role, 'reports'])}">
        <div
          class="w-6 h-6 flex items-center justify-center rounded-lg text-gray-500 group-hover:text-blue-600 group-hover:bg-blue-100/50 transition-colors"
          [ngClass]="{'mr-3': sidebarOpen || !isDesktop}">
          <i class="fas fa-file-alt"></i>
        </div>
        <span *ngIf="sidebarOpen || !isDesktop">Reports</span>
      </a>
    </div>

    <!-- Admin-only section -->
    <div *ngIf="role === 'admin' || role === 'hod'"
      [ngClass]="{'pt-4': sidebarOpen || !isDesktop, 'pt-3': !sidebarOpen && isDesktop}">
      <p *ngIf="sidebarOpen || !isDesktop"
        class="px-3 text-xs font-semibold text-gray-500 uppercase tracking-wider section-title">ADMINISTRATION</p>
      <p *ngIf="!sidebarOpen && isDesktop"
        class="flex justify-center text-xs font-semibold text-gray-500 tracking-wider section-title">
        <i class="fas fa-cog"></i>
      </p>

      <a [routerLink]="['/', role, 'users']" routerLinkActive="bg-blue-50 text-blue-700"
        [routerLinkActiveOptions]="{exact: true}"
        class="flex items-center py-2.5 mt-1 rounded-lg hover:bg-gray-100 transition-all duration-200 group nav-link"
        [ngClass]="{'px-3': sidebarOpen || !isDesktop, 'px-2 justify-center': !sidebarOpen && isDesktop, 'border-l-4 border-blue-600': sidebarOpen && isActiveRoute(['/', role, 'users'])}">
        <div
          class="w-6 h-6 flex items-center justify-center rounded-lg text-gray-500 group-hover:text-blue-600 group-hover:bg-blue-100/50 transition-colors"
          [ngClass]="{'mr-3': sidebarOpen || !isDesktop}">
          <i class="fas fa-users"></i>
        </div>
        <span *ngIf="sidebarOpen || !isDesktop">User Management</span>
      </a>

      <a [routerLink]="['/', role, 'departments']" routerLinkActive="bg-blue-50 text-blue-700"
        [routerLinkActiveOptions]="{exact: true}"
        class="flex items-center py-2.5 rounded-lg hover:bg-gray-100 transition-all duration-200 group nav-link"
        [ngClass]="{'px-3': sidebarOpen || !isDesktop, 'px-2 justify-center': !sidebarOpen && isDesktop, 'border-l-4 border-blue-600': sidebarOpen && isActiveRoute(['/', role, 'departments'])}">
        <div
          class="w-6 h-6 flex items-center justify-center rounded-lg text-gray-500 group-hover:text-blue-600 group-hover:bg-blue-100/50 transition-colors"
          [ngClass]="{'mr-3': sidebarOpen || !isDesktop}">
          <i class="fas fa-building"></i>
        </div>
        <span *ngIf="sidebarOpen || !isDesktop">Departments</span>
      </a>

      <a [routerLink]="['/', role, 'settings']" routerLinkActive="bg-blue-50 text-blue-700"
        [routerLinkActiveOptions]="{exact: true}"
        class="flex items-center py-2.5 rounded-lg hover:bg-gray-100 transition-all duration-200 group nav-link"
        [ngClass]="{'px-3': sidebarOpen || !isDesktop, 'px-2 justify-center': !sidebarOpen && isDesktop, 'border-l-4 border-blue-600': sidebarOpen && isActiveRoute(['/', role, 'settings'])}">
        <div
          class="w-6 h-6 flex items-center justify-center rounded-lg text-gray-500 group-hover:text-blue-600 group-hover:bg-blue-100/50 transition-colors"
          [ngClass]="{'mr-3': sidebarOpen || !isDesktop}">
          <i class="fas fa-cog"></i>
        </div>
        <span *ngIf="sidebarOpen || !isDesktop">System Settings</span>
      </a>
    </div>

    <!-- Knowledge Base Section -->
    <div [ngClass]="{'pt-4': sidebarOpen || !isDesktop, 'pt-3': !sidebarOpen && isDesktop}">
      <p *ngIf="sidebarOpen || !isDesktop"
        class="px-3 text-xs font-semibold text-gray-500 uppercase tracking-wider section-title">RESOURCES</p>
      <p *ngIf="!sidebarOpen && isDesktop"
        class="flex justify-center text-xs font-semibold text-gray-500 tracking-wider section-title">
        <i class="fas fa-book"></i>
      </p>

      <a [routerLink]="['/', role, 'knowledge-base']" routerLinkActive="bg-blue-50 text-blue-700"
        [routerLinkActiveOptions]="{exact: true}"
        class="flex items-center py-2.5 mt-1 rounded-lg hover:bg-gray-100 transition-all duration-200 group nav-link"
        [ngClass]="{'px-3': sidebarOpen || !isDesktop, 'px-2 justify-center': !sidebarOpen && isDesktop, 'border-l-4 border-blue-600': sidebarOpen && isActiveRoute(['/', role, 'knowledge-base'])}">
        <div
          class="w-6 h-6 flex items-center justify-center rounded-lg text-gray-500 group-hover:text-blue-600 group-hover:bg-blue-100/50 transition-colors"
          [ngClass]="{'mr-3': sidebarOpen || !isDesktop}">
          <i class="fas fa-book"></i>
        </div>
        <span *ngIf="sidebarOpen || !isDesktop">Knowledge Base</span>
      </a>

      <a [routerLink]="['/', role, 'faq']" routerLinkActive="bg-blue-50 text-blue-700"
        [routerLinkActiveOptions]="{exact: true}"
        class="flex items-center py-2.5 rounded-lg hover:bg-gray-100 transition-all duration-200 group nav-link"
        [ngClass]="{'px-3': sidebarOpen || !isDesktop, 'px-2 justify-center': !sidebarOpen && isDesktop, 'border-l-4 border-blue-600': sidebarOpen && isActiveRoute(['/', role, 'faq'])}">
        <div
          class="w-6 h-6 flex items-center justify-center rounded-lg text-gray-500 group-hover:text-blue-600 group-hover:bg-blue-100/50 transition-colors"
          [ngClass]="{'mr-3': sidebarOpen || !isDesktop}">
          <i class="fas fa-question-circle"></i>
        </div>
        <span *ngIf="sidebarOpen || !isDesktop">FAQs</span>
      </a>
    </div>
  </div>

  <!-- Quick Actions Section with Enhanced Buttons -->
  <div class="mt-auto p-4 border-t border-gray-200 bg-gray-50" [ngClass]="{'p-2': !sidebarOpen && isDesktop}">
    <button *ngIf="sidebarOpen || !isDesktop" (click)="openFeedbackForm()"
      class="w-full flex items-center justify-center px-4 py-2.5 text-sm font-medium text-white bg-gradient-to-r from-indigo-600 to-indigo-700 hover:from-indigo-700 hover:to-indigo-800 rounded-lg transition-all shadow-sm hover:shadow action-button">
      <i class="fas fa-plus mr-2"></i> New Complaint
    </button>

    <button *ngIf="!sidebarOpen && isDesktop" (click)="openFeedbackForm()"
      class="w-full flex items-center justify-center p-2 text-sm font-medium text-white bg-gradient-to-r from-indigo-600 to-indigo-700 hover:from-indigo-700 hover:to-indigo-800 rounded-lg transition-all shadow-sm hover:shadow action-button">
      <i class="fas fa-plus"></i>
    </button>

    <!-- Collapse/Expand Button (Desktop only) -->
    <button *ngIf="isDesktop" (click)="toggleSidebar()"
      class="mt-2 w-full flex items-center justify-center p-2 text-sm font-medium text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-lg transition-colors">
      <i class="fas" [ngClass]="sidebarOpen ? 'fa-chevron-left' : 'fa-chevron-right'"></i>
      <span *ngIf="sidebarOpen" class="ml-2">Collapse</span>
    </button>
  </div>
</div>

<!-- Sidebar Backdrop (Mobile) with Improved Blur -->
<div *ngIf="sidebarOpen && !isDesktop" (click)="toggleSidebar()"
  class="fixed inset-0 z-20 bg-black bg-opacity-50 transition-opacity backdrop-blur-sm backdrop mt-16">
</div>

<!-- Toggle Button (Mobile) with Enhanced Animation -->
<button *ngIf="!sidebarOpen && !isDesktop" (click)="toggleSidebar()"
  class="fixed bottom-5 left-5 z-30 p-3 bg-gradient-to-r from-indigo-600 to-indigo-700 text-white rounded-full shadow-lg hover:shadow-indigo-500/30 transition-all toggle-button">
  <i class="fas fa-bars"></i>
</button>